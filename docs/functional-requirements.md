### **禁煙アプリ 機能要件定義書**

#### 1. 前提条件

- 本要件定義は、アプリの根幹をなす「必須の 3 大機能」にスコープを絞る。
- ユーザーの基本情報（禁煙開始日時、1 日の喫煙本数など）は、オンボーディング時に`user_profile`テーブルに正しく保存されているものとする。
- UI デザインは FIX しており、本ドキュメントでは各 UI コンポーネントが表示すべきデータと振る舞いを定義する。
- すべての計算は、原則として`user_profile`テーブルのデータを基に、画面表示時にリアルタイムで実行する。

---

### 機能 ID: F01 - 禁煙状況の「見える化」機能

| 項目           | 内容                                                                                                                                                                                                       |
| :------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **概要**       | ユーザーの禁煙による成果（継続時間、節約金額、我慢した本数）をホーム画面などで常に表示し、禁煙継続のモチベーションを高める。                                                                               |
| **トリガー**   | ユーザーがホーム画面（本機能が表示される画面）を開く、またはアプリをフォアグラウンドにする。                                                                                                               |
| **データ要件** | ・`user_profile.smokingStartDate` （禁煙開始日時）<br>・`user_profile.cigsPerDay` （1 日の喫煙本数）<br>・`user_profile.pricePerPack` （タバコ 1 箱の価格）<br>・`user_profile.cigsPerPack` （1 箱の本数） |

#### **表示項目と仕様**

| 表示項目                      | 仕様                                                                                                                     | 計算ロジック / 補足                                                                                                                                                      |
| :---------------------------- | :----------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **1. 禁煙継続時間カウンター** | 禁煙開始からの経過時間を「XX 日 XX 時間 XX 分 XX 秒」の形式で表示する。カウンターは 1 秒ごとにリアルタイムで更新される。 | `現在時刻`と`user_profile.smokingStartDate`の差分を計算する。<br>（実装想定: `date-fns`の`intervalToDuration`関数を利用）                                                |
| **2. 節約金額カウンター**     | 禁煙によって節約できた金額の累計を整数で表示する。（例: 「1,500 円」）                                                   | `(pricePerPack / cigsPerPack) * 我慢した本数` で算出する。<br>計算は画面が表示されるたびに行う。                                                                         |
| **3. 我慢した本数カウンター** | 禁煙によって吸わなかったタバコの本数の累計を整数で表示する。（例: 「100 本」）                                           | `cigsPerDay * 禁煙継続満日数` で算出する。<br>禁煙継続満日数は、`現在時刻`と`smokingStartDate`の差分から計算する。（実装想定: `date-fns`の`differenceInDays`関数を利用） |

<br>

---

### 機能 ID: F02 - 喫煙欲求への「対処法サポート」機能

| 項目           | 内容                                                                                                                     |
| :------------- | :----------------------------------------------------------------------------------------------------------------------- |
| **概要**       | ユーザーが強い喫煙衝動に駆られた際に、すぐに実践できる具体的な対処法を提示し、その危機を乗り越えるためのサポートを行う。 |
| **トリガー**   | ユーザーがアプリ内に設置された「吸いたくなったら押す」ボタンをタップする。                                               |
| **データ要件** | なし（データベースへのアクセスは不要）                                                                                   |

#### **表示項目と仕様**

| 表示項目            | 仕様                                                                                                                              | 補足                                                                                                                                                                                  |
| :------------------ | :-------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **1. 対処法の表示** | ボタンをタップすると、事前定義された対処法のリストから、ランダムに 1 つの対処法が画面に表示される。（例: ポップアップや専用画面） | 対処法のリストは、アプリのコード内に直接記述（ハードコード）する。<br>例: 「深呼吸を 5 回する」「冷たい水を飲む」「3 分間だけ他のことを考える」など、複数のバリエーションを用意する。 |

<br>

---

### 機能 ID: F03 - 達成感の演出（アチーブメント）機能

| 項目           | 内容                                                                                                                                           |
| :------------- | :--------------------------------------------------------------------------------------------------------------------------------------------- |
| **概要**       | 禁煙継続時間や我慢した本数などに応じて設定された目標（アチーブメント）の達成状況を表示し、ユーザーに成功体験を提供することで禁煙の継続を促す。 |
| **トリガー**   | ユーザーがアチーブメント一覧画面（「せいか」画面など）を開く。                                                                                 |
| **データ要件** | ・`user_profile.smokingStartDate` （禁煙開始日時）<br>・`user_profile.cigsPerDay` （1 日の喫煙本数）                                           |

#### **表示項目と仕様**

| 表示項目                  | 仕様                                                                                                                                               | 判定ロジック例 / 補足                                                                                                                                                                                                                                                                                                |
| :------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **1. アチーブメント一覧** | 事前定義されたすべてのアチーブメント（例: バッジ）を一覧で表示する。                                                                               | アチーブメントリストもアプリ内にハードコードする。<br>（例: 「最初の 24 時間」「3 日間クリア」「1 週間達成」「100 本我慢」「1,000 円節約」など）                                                                                                                                                                     |
| **2. 達成状況の表示**     | **達成済み**のアチーブメントは、カラー表示や明るい表示にする。<br>**未達成**のアチーブメントは、グレーアウト表示や鍵付きのアイコンなどで表現する。 | 達成状況は、画面を開くたびに`user_profile`のデータと現在時刻を基に**リアルタイムで判定**する。達成フラグなどをデータベースに保存する必要はない。                                                                                                                                                                     |
| **3. 達成条件の判定**     | 各アチーブメントに設定された条件を、リアルタイム計算の結果が満たしているかどうかで判定する。                                                       | ・**時間ベース**: `現在時刻`と`smokingStartDate`の差分が条件（例: 24 時間）以上か判定。（実装想定: `differenceInHours`, `differenceInDays`などを利用）<br>・**本数ベース**: 「我慢した本数」の計算結果が条件（例: 100 本）以上か判定。<br>・**金額ベース**: 「節約金額」の計算結果が条件（例: 1,000 円）以上か判定。 |
