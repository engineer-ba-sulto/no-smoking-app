### **禁煙アプリ MVP 実装計画書**

#### 1. プロジェクトのゴール

本計画のゴールは、機能要件定義書で定められた**必須の 3 大機能（F01, F02, F03）を完全に実装し、動作する MVP（Minimum Viable Product）を完成させること**である。

#### 2. 全体方針

- UI コンポーネントは実装済みと仮定し、**データ連携とビジネスロジックの実装**に焦点を当てる。
- 最初にアプリケーションの土台となる**データ基盤**を構築し、その後、各機能を積み上げる形で開発を進める。
- UI から独立してテスト可能な**計算ロジック（ユーティリティ）**を先に実装することで、手戻りを減らし、開発効率を高める。

---

#### 3. 実装フェーズと詳細タスク

開発作業を以下の 4 つのフェーズに分割して進める。

---

##### **【フェーズ 1】 開発環境とデータ基盤のセットアップ (最優先)**

**目的:** 全機能の基礎となるデータベース環境を構築し、アプリケーションの骨格を完成させる。

| タスク ID | タスク内容                              | 担当領域     | 依存タスク | 備考                                                                                   |
| :-------- | :-------------------------------------- | :----------- | :--------- | :------------------------------------------------------------------------------------- |
| `T1-1`    | Drizzle ORM と Expo SQLite の導入・設定 | データベース | -          | データベース接続とマイグレーションの準備を完了させる。                                 |
| `T1-2`    | `user_profile`テーブルのスキーマ定義    | データベース | `T1-1`     | `db/schema.ts` に機能要件で必要な全カラムを定義する。                                  |
| `T1-3`    | データ操作用リポジトリ層の実装          | バックエンド | `T1-2`     | ユーザープロファイルを取得・更新するための基本的な関数群を用意する。                   |
| `T1-4`    | 開発用データのシーディング              | 開発効率     | `T1-3`     | オンボーディング機能実装前に、動作確認用のダミーデータを投入するスクリプトを用意する。 |

---

##### **【フェーズ 2】 コアビジネスロジックの実装**

**目的:** アプリケーションの頭脳となる計算ロジックを実装する。この時点では UI との連携は意識せず、ロジックの正確性を担保することに集中する。

| タスク ID | タスク内容                                 | 担当領域         | 依存タスク | 備考                                                                                                                 |
| :-------- | :----------------------------------------- | :--------------- | :--------- | :------------------------------------------------------------------------------------------------------------------- |
| `T2-1`    | 日付計算ユーティリティの作成               | ビジネスロジック | -          | `date-fns`を使用し、禁煙継続時間や日数を計算する再利用可能な関数を作成する。                                         |
| `T2-2`    | **[F01, F03]** 成果計算ロジックの実装      | ビジネスロジック | `T2-1`     | `user_profile`のデータを引数に取り、我慢した本数と節約金額を返す純粋な関数を実装する。                               |
| `T2-3`    | **[F03]** アチーブメント判定ロジックの実装 | ビジネスロジック | `T2-2`     | すべてのアチーブメントの達成条件（時間、本数、金額）を定義し、現在の成果データから達成状況を判定する関数を実装する。 |

---

##### **【フェーズ 3】 UI コンポーネントとのデータ連携**

**目的:** 実装済みのロジックと UI コンポーネントを接続し、ユーザーが操作できる状態の機能を完成させる。

| タスク ID | タスク内容                                     | 担当領域       | 依存タスク     | 備考                                                                                                                                                        |
| :-------- | :--------------------------------------------- | :------------- | :------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `T3-1`    | **[F01]** 「見える化」機能の画面組み込み       | フロントエンド | `T1-3`, `T2-2` | ホーム画面が表示される際に`user_profile`を読み込み、計算結果を各カウンター UI に表示する。継続時間カウンターのリアルタイム更新も実装する。                  |
| `T3-2`    | **[F03]** 「アチーブメント」機能の画面組み込み | フロントエンド | `T1-3`, `T2-3` | 「せいか」画面表示時にアチーブメント判定ロジックを呼び出し、結果に応じて各バッジの表示（カラー/グレーアウト）を動的に切り替える。                           |
| `T3-3`    | **[F02]** 「対処法サポート」機能の実装         | フロントエンド | -              | 「吸いたくなったら押す」ボタンのイベントを実装し、ハードコードされた対処法リストからランダムに 1 つをモーダル等で表示する。このタスクは他への依存が少ない。 |

---

##### **【フェーズ 4】 統合テストと最終調整**

**目的:** アプリ全体を通しての動作を保証し、リリース可能な品質に仕上げる。

| タスク ID | タスク内容                                   | 担当領域 | 依存タスク             | 備考                                                                                                             |
| :-------- | :------------------------------------------- | :------- | :--------------------- | :--------------------------------------------------------------------------------------------------------------- |
| `T4-1`    | 全機能の結合テスト                           | QA       | `T3-1`, `T3-2`, `T3-3` | アプリを新規インストールし、オンボーディング（ダミーデータで代替）から各機能の表示・動作が仕様通りかを確認する。 |
| `T4-2`    | エッジケースのテスト                         | QA       | `T4-1`                 | 禁煙開始直後、日付や月をまたぐ瞬間など、計算が複雑になるケースを重点的にテストする。                             |
| `T4-3`    | パフォーマンスチューニングとリファクタリング | 全員     | `T4-2`                 | アプリの起動速度や画面描画に問題がないか確認し、必要に応じてコードを改善する。                                   |

---

#### 4. 実装の優先順位と推奨フロー

1.  **フェーズ 1** を最優先で完了させ、開発の土台を固めます。
2.  次に **フェーズ 2** に着手し、アプリの計算ロジックを実装します。ロジックの単体テストを徹底することが後の手戻りを防ぎます。
3.  **フェーズ 3** では、計算ロジックを多用する **`T3-1` (見える化) と `T3-2` (アチーブメント) を並行または連続して実装**するのが効率的です。独立性の高い `T3-3` (対処法サポート) は、これらの後でも問題ありません。
4.  最後に **フェーズ 4** で全体の品質を確保します。

この計画に沿って開発を進めることで、依存関係を整理し、各開発者が効率的にタスクに取り組むことが可能になります。
