# T4-4-0: DBリセット機能のバグ修正

## 概要

開発効率化のために用意されたデータベース全件削除機能 `clearAllData` が、実装上の問題により意図通りに動作していないバグを修正します。

## 目的

- 開発者が任意のタイミングでデータベースを初期状態に戻せるようにする。
- テストの再現性を高め、開発効率を向上させる。

## 依存関係

- **依存タスク**: -
- **担当領域**: 開発効率

## サブチケット

- **T4-4-1**: `clearAllData`関数の問題分析
- **T4-4-2**: データベース全件削除ロジックの修正
- **T4-4-3**: 修正後のリセット機能のテスト

## 実装詳細

`implementation_check_report.md`によると、`drizzle/seeders/main-seeder.ts` にある `clearAllData` 関数内の `db.delete` に削除条件が指定されていないため、Drizzle ORMが安全のために処理を中断している可能性があります。スキーマ内の全てのテーブルを対象に、明示的に全件削除を行う処理に修正する必要があります。

## 実装手順

1. **問題の特定**: `clearAllData`関数を実行し、データが削除されないことを再現します。
2. **ロジックの修正**: Drizzleのスキーマ情報を参照し、存在するすべてのテーブルに対して`db.delete(table)`を実行するよう修正します。
3. **動作確認**: 修正後に`clearAllData`を再度実行し、すべてのテーブルが空になることを確認します。

## 完了条件

- [ ] `clearAllData`関数を実行すると、データベース内のすべてのテーブルの全データが削除される。

## 次のタスク

- **T5-1**: グラフ機能の実装
- **依存関係**: 本タスクが完了することで、クリーンな状態からのテストが容易になる。

## 備考

この修正はアプリケーションのコア機能ではありませんが、開発全体の生産性に影響するため、優先度は比較的高いです。
