# T4-1-3: UIとリポジトリの連携

## 概要

`cigarettes-setting.tsx`のUIと`user-profile-repository.ts`の更新ロジックを連携させます。

## 目的

- ユーザーによるUI操作が、実際にデータベースに反映されるようにする。
- フロントエンドとバックエンドの処理を結合し、一連の機能として完成させる。

## 依存関係

- **依存タスク**: T4-1-1, T4-1-2
- **担当領域**: フロントエンド/バックエンド

## 実装詳細

### 1. イベントハンドラの実装
`cigarettes-setting.tsx`の「保存」ボタンに`onPress`イベントハンドラを追加します。

### 2. リポジトリメソッドの呼び出し
イベントハンドラ内で、`userProfileRepository.updateCigarettesPerDay`メソッドを呼び出します。その際、数値入力フィールドの値を引数として渡します。

### 3. 状態管理の更新
データベース更新後、`useSmokerData`フックが保持している状態も更新する必要があります。`mutate`関数などを呼び出して、UIに最新のデータが反映されるようにします。

## 実装手順

1. **ファイルを開く**: `src/app/settings/cigarettes-setting.tsx` を開きます。
2. **リポジトリのインポート**: `userProfileRepository`をインポートします。
3. **イベントハンドラ作成**: 「保存」ボタンが押されたときに、入力された値で`updateCigarettesPerDay`を呼び出す関数を作成します。
4. **状態の再検証**: 更新処理の成功後、`useSmokerData`の`mutate`を呼び出し、関連するUIが再描画されるようにします。

## 完了条件

- [ ] 設定画面の「保存」ボタンを押すと、`updateCigarettesPerDay`メソッドが呼び出される。
- [ ] データベース更新後、UI上の表示も新しい値に更新される。

## 次のタスク

- **T4-1-4**: 編集機能のテスト
- **依存関係**: このタスクの完了が前提となる。

## トラブルシューティング

### よくある問題

1. **データ更新後もUIの表示が変わらない**

   ```bash
   # 解決方法
   # SWRなどの状態管理ライブラリのキャッシュが原因の可能性がある。
   # mutate関数を呼び出して、キャッシュを手動で更新（再検証）する必要がある。
   ```

## 備考

非同期処理となるため、更新中はローディング表示を出すなど、UI/UXへの配慮が望ましいです（本タスクでは必須としない）。
