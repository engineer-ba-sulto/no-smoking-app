# T1-4-3: データベース管理画面の実装

## 概要

開発およびテスト作業を効率化するため、アプリケーション内にデータベース管理画面を実装する。この画面から、テストデータの投入（シーディング）、全データ削除（クリーン）、およびデータ件数の確認（ベリファイ）を直接実行できるようにする。

## 目的

- 開発者が手動でコマンドを打つことなく、UI 上から簡単にデータベースの状態をリセット・初期化できるようにする。
- QA（品質保証）担当者が、特定のデータセットを持つ状態でアプリケーションの動作をテストしやすくする。
- `src/drizzle/seeders` に実装済みのシーディングロジックを、UI コンポーネントから呼び出せるようにする。

## 依存関係

- **親タスク**: T1-4-0 (開発用データのシーディング)
- **依存タスク**: T1-4-2 (シーディングスクリプトの実装)
- **担当領域**: 開発効率, UI/UX

## 実装詳細

### 1. データベース管理 UI の設計と実装

`src/components/DatabaseManager.tsx` を中心に、以下の機能を持つ UI コンポーネントを実装する。

- **現在のデータ件数表示**
  - `user_profiles` テーブルの現在のレコード数を表示する。
  - `useEffect` で初期表示し、各操作後に再取得して更新する。
- **操作ボタンの実装**
  - **全データ削除 (Clean)**: `mainSeeder.clearAllData()` を呼び出すボタン。
  - **基本データ投入 (Seed Basic)**: `testDataSets.basicSet` を使って `mainSeeder.seedFromDataSet()` を呼び出すボタン。
  - **全データ投入 (Seed All)**: `testDataSets.allSets` を使って `mainSeeder.seedFromDataSet()` を呼び出すボタン。
- **フィードバック**
  - 各ボタンをタップした際に、処理中であることがわかるようにローディングインジケーターを表示する。
  - 処理が完了したら、成功または失敗のメッセージをトーストやアラートで表示する。

### 2. 投入されるデータセットの詳細

- **基本データ投入 (Seed Basic)**: UI の基本的な表示確認に使う、3 件の典型的なユーザーデータ (`basicSet`) を投入します。
  - 7 日前、30 日前、90 日前に禁煙を開始したユーザーが含まれます。
- **全データ投入 (Seed All)**: 計算ロジックの境界値テストやアチーブメント機能のテストに使用するデータを含む、合計 11 件の全データ (`basicSet`, `edgeCaseSet`, `achievementTestSet`) を投入します。
  - 1 分前や 1 年前に禁煙したユーザー、喫煙本数やタバコ価格が 0 のユーザー、各アチーブメント達成直前のユーザーなどが含まれます。

### 3. シーダーロジックの接続

- `src/drizzle/seeders/main-seeder.ts` に定義されている `MainSeeder` クラスの各メソッドを、UI コンポーネントから呼び出せるようにする。
- `DatabaseManagerComponent` 内で `MainSeeder` のインスタンスを生成し、各ボタンの `onPress` イベントハンドラから対応するメソッドを呼び出す。

## 実装手順

1. `src/components/DatabaseManager.tsx` を開き、UI のレイアウトを実装する（データ件数表示エリア、操作ボタン群）。
2. `useState` を用いて、現在のユーザープロファイル数とローディング状態を管理する state 変数を定義する。
3. `useEffect` を用いて、コンポーネントのマウント時に現在のデータ件数を取得し、state を更新するロジックを実装する。
4. 「全データ削除」「基本データ投入」「全データ投入」の各ボタンに対応する `onPress` ハンドラを実装する。
   - 各ハンドラ内で、`setLoading(true)` を呼び出す。
   - `MainSeeder` の適切なメソッドを `try...catch` ブロック内で実行する。
   - 成功時には成功メッセージを表示し、失敗時にはエラーメッセージを表示する。
   - `finally` ブロックで `setLoading(false)` を呼び出し、現在のデータ件数を再取得する。
5. `src/app/database-manager.tsx` が `DatabaseManagerComponent` を正しく呼び出していることを確認する。

## 完了条件

- [ ] 設定画面から「データベース管理」画面に遷移できる。
- [ ] 画面に現在の `user_profiles` テーブルのレコード数が表示される。
- [ ] 「全データ削除」ボタンを押すと、データベースからすべてのユーザープロファイルが削除され、件数表示が `0` に更新される。
- [ ] 「基本データ投入」ボタンを押すと、`basicSet` のデータが投入され、件数表示が更新される。
- [ ] 「全データ投入」ボタンを押すと、`allSets` のデータが投入され、件数表示が更新される。
- [ ] 各操作の実行中には、ユーザーに処理中であることがわかるフィードバックが提供される。

## 次のタスク

- **T2-1**: 日付計算ユーティリティの作成
