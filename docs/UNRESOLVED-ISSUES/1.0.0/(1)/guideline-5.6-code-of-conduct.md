# ガイドライン 5.6 - 開発者行動規範

## 審査環境情報

- **提出 ID**: 44eb3e0b-9beb-4149-bda2-6400d703f681
- **審査日**: 2025 年 11 月 25 日
- **審査対象バージョン**: 1.0.0
- **ガイドライン**: 5.6 - Developer Code of Conduct

---

## 問題点

アプリが顧客を操作して、不要なアプリ内購入を行わせようとしています。具体的には、アプリがユーザーに 2 回目としてサブスクリプションの購入を促しています。

---

## 対応方法

- 開発者行動規範を確認してください
- これらの要件に準拠するようにアプリを修正してください
- アプリが完全に準拠したら、アプリを再提出して審査を受けてください

---

## 対応状況

### ✅ 修正完了

2 回目の購入プロンプトを防ぐための実装を完了しました。

#### 修正内容

1. **ワンタイムオファーの表示制御**

   - ペイウォール画面を閉じた際に、ワンタイムオファー画面に遷移する処理を修正
   - 既にワンタイムオファーを閉じたことがある場合は、直接アプリを閉じるように変更
   - AsyncStorage を使用して、ワンタイムオファーを閉じた状態を永続化

2. **サブスクリプション状態チェックの追加**

   - ワンタイムオファー画面とペイウォール画面の両方で、サブスクリプション状態をチェック
   - 既に有効なサブスクリプションがある場合は、メイン画面に自動遷移
   - これにより、既にサブスクリプションを持っているユーザーに不要な購入プロンプトが表示されないように改善

3. **購入成功時の状態記録**

   - ワンタイムオファー画面で購入成功時にも、ワンタイムオファーを閉じたことを記録
   - 購入後はワンタイムオファーが二度と表示されないように改善

4. **共通関数の抽出**
   - サブスクリプション状態チェックのロジックを共通ユーティリティ関数として抽出
   - `src/utils/subscription-check.ts`に実装し、コードの重複を削減

#### 修正ファイル

- `src/app/(paywalls)/paywall.tsx`: ワンタイムオファーへの遷移条件を修正、サブスクリプション状態チェックを追加
- `src/app/(paywalls)/one-time-offer.tsx`: サブスクリプション状態チェックを追加、購入成功時の状態記録を追加
- `src/utils/subscription-check.ts`: サブスクリプション状態チェックの共通関数を新規作成
- `src/utils/one-time-offer-storage.ts`: 既存の状態管理関数を使用

#### 実装のポイント

- ガイドライン 5.6 の要件（2 回目の購入プロンプトを防ぐ）を完全に満たす実装
- 既にサブスクリプションを持っているユーザーに不要な購入プロンプトが表示されない
- 購入成功後、ワンタイムオファーが二度と表示されない
- エラーハンドリングを適切に実装し、アプリがクラッシュしないように配慮

#### 次のステップ

1. アプリをビルドして動作確認
2. App Store Connect に再提出
3. 審査結果を待つ

---

## 参考リソース

- 開発者行動規範を確認
